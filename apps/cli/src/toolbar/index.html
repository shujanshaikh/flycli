<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Coding Agent</title>
  <style>
    /* Toolbar overlay styles */
    #coding-agent-toolbar {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 400px;
      height: 600px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      z-index: 999999;
      display: flex;
      flex-direction: column;
      font-family: system-ui, -apple-system, sans-serif;
    }
    
    #toolbar-header {
      padding: 16px;
      border-bottom: 1px solid #e5e7eb;
      font-weight: 600;
    }
    
    #chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }
    
    .message {
      margin-bottom: 12px;
      padding: 8px 12px;
      border-radius: 8px;
    }
    
    .message.user {
      background: #3b82f6;
      color: white;
      margin-left: 40px;
    }
    
    .message.agent {
      background: #f3f4f6;
      color: #111827;
      margin-right: 40px;
    }
    
    #input-container {
      padding: 16px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      gap: 8px;
    }
    
    #message-input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      font-size: 14px;
    }
    
    #send-button {
      padding: 8px 16px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }
    
    #send-button:hover {
      background: #2563eb;
    }
    
    #send-button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <!-- The toolbar overlay -->
  <div id="coding-agent-toolbar">
    <div id="toolbar-header">
      ðŸ¤– Coding Agent
    </div>
    <div id="chat-container">
      <!-- Messages will appear here -->
    </div>
    <div id="input-container">
      <input 
        type="text" 
        id="message-input" 
        placeholder="Ask me to change your code..."
      />
      <button id="send-button">Send</button>
    </div>
  </div>

  <script type="module">
    // Connect to WebSocket
    const ws = new WebSocket('ws://localhost:3100/ws');
    
    const chatContainer = document.getElementById('chat-container');
    const messageInput = document.getElementById('message-input');
    const sendButton = document.getElementById('send-button');
    
    // Add message to chat
    function addMessage(content, type) {
      const div = document.createElement('div');
      div.className = `message ${type}`;
      div.textContent = content;
      chatContainer.appendChild(div);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    
    // Send message
    function sendMessage() {
      const message = messageInput.value.trim();
      if (!message) return;
      
      addMessage(message, 'user');
      
      ws.send(JSON.stringify({
        type: 'chat_message',
        content: message
      }));
      
      messageInput.value = '';
    }
    
    // Event listeners
    sendButton.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });
    
    // WebSocket events
    ws.addEventListener('open', () => {
      console.log('Connected to agent');
      sendButton.disabled = false;
    });
    
    ws.addEventListener('message', (event) => {
      const data = JSON.parse(event.data);
      
      if (data.type === 'agent_message') {
        addMessage(data.content, 'agent');
      }
    });
    
    ws.addEventListener('close', () => {
      console.log('Disconnected from agent');
      sendButton.disabled = true;
    });
  </script>

  <!-- Load the user's app in an iframe -->
  <iframe 
    src="http://localhost:3000" 
    style="width: 100%; height: 100%; border: none; position: fixed; top: 0; left: 0; z-index: -1;"
  ></iframe>
</body>
</html>